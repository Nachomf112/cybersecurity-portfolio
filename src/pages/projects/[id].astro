---
import { getCollection, render } from "astro:content";
import { Image } from "astro:assets";
import Layout from "../../layouts/Layout.astro";
import BackBtn from "@/components/BackBtn.astro";
import BackToTop from "@/components/BackToTop.astro";

// Genera rutas estáticas para cada proyecto
export async function getStaticPaths() {
  const posts = await getCollection("projects");
  return posts.map((post) => ({
    params: { id: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { title, summary, tags, cover, ogImage, url } = post.data;
const { Content } = await render(post);
---

<Layout title={title} description={summary} imageOg={ogImage} scrollSmooth={true}>
  <div class="flex justify-center mt-10">
    <BackBtn />
  </div>

  <div class="flex flex-col gap-6 justify-center items-center">
    <h1 class="text-3xl font-bold text-center text-white">{title}</h1>
    <p class="text-sm text-zinc-500 dark:text-zinc-300">
      {tags.join(" · ")}
    </p>
  </div>

  {cover && (
    <Image
      transition:name={`${post.id}-img`}
      class="rounded-2xl"
      src={cover}
      alt="Main project image"
    />
  )}

  {summary && <p class="mt-6 text-zinc-300">{summary}</p>}

  {url && (
    <p class="mt-3">
      <a
        href={url}
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center gap-2 rounded-lg px-5 py-3
               bg-amber-400 text-black font-semibold shadow-sm
               hover:bg-amber-300 active:bg-amber-300
               focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-amber-300">
        Abrir demo <span aria-hidden="true">↗</span>
      </a>
    </p>
  )}

  <!-- Contenido MDX con tipografía accesible en fondo oscuro -->
  <article
    id="article"
    class="mt-10 prose dark:prose-invert lg:prose-lg text-zinc-100
           prose-headings:text-white prose-strong:text-zinc-100
           prose-a:text-amber-300 hover:prose-a:text-amber-200
           prose-blockquote:text-zinc-200 prose-code:text-emerald-300
           prose-li:marker:text-amber-400"
  >
    <Content />
  </article>

  <BackToTop />
</Layout>

<style is:global>
  /* Asegura alto contraste dentro del artículo renderizado con Typography */
  #article.prose :where(em):not(:where(.not-prose *)) {
    /* Los <em> venían muy tenues; los ponemos legibles */
    @apply not-italic text-white/90;
  }

  #article.prose :where(a):not(:where(.not-prose *)) {
    /* Enlaces dentro del artículo bien visibles en dark */
    @apply text-amber-300 underline underline-offset-4 decoration-amber-400/50 hover:text-amber-200;
  }

  /* Por si algún navegador aplica color al enlace-botón */
  a.bg-amber-400 { @apply text-black !important; }

  /* Títulos del artículo algo más visibles */
  #article h2 { @apply text-2xl font-bold my-4; }

  /* Evitar cortes feos en bloques de código largos */
  .prose pre code { white-space: pre-wrap; word-break: break-word; }
</style>
